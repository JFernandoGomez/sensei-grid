/**
 * sensei-grid v0.3.4
 * Copyright (c) 2015 Lauris Dzilums <lauris@discuss.lv>
 * Licensed under MIT 
*/
!function(a){a.fn.grid=function(b,c,d){var e=this,f={emptyRow:!1,sortable:!0,tableClass:"table table-bordered table-condensed"};e.isEditing=!1,e.$prevRow=null,e.editorProps={},e.preventEnter=!1,a.fn.isOnScreen=function(){var b=a(window),c={top:b.scrollTop(),left:b.scrollLeft()};c.right=c.left+b.width(),c.bottom=c.top+b.height();var d=this.offset();return d.right=d.left+this.outerWidth(),d.bottom=d.top+this.outerHeight(),!(c.right<d.left||c.left>d.right||c.bottom<d.top||c.top>d.bottom)};var g=function(a){var b=a.get(0),c=b.style.display;b.style.display="none",b.offsetHeight,b.style.display=c},h=function(a){return a.replace(/\r\n/g,"\n")};return a.fn.setActiveCell=function(){e.$prevRow=a("tr>.activeCell",e.$el).parent("tr"),e.$prevRow.removeClass("activeRow"),a("tr>.activeCell",e.$el).removeClass("activeCell"),a(this).addClass("activeCell"),a(this).parent("tr").addClass("activeRow"),g(a(this).parent("tr")),e.events.trigger("cell:select",a(this)),e.$prevRow.index()!==a(this).parent("tr").index()&&(e.events.trigger("row:select",a(this).parent("tr")),e.$prevRow.hasClass("sensei-grid-dirty-row")&&e.isEditing&&(e.saveEditor(!0),e.events.trigger("row:save",e.getRowData(e.$prevRow),e.$prevRow,"row:select")))},a.fn.cellPosition=function(){var b=a(this).position();return e.isSillyFirefox()&&(b.left-=1,b.top-=1),b},e.events={_events:{}},e.events.on=function(a,b,c){_.has(this._events,a)||(this._events[a]=[]),this._events[a].push({callback:b,context:c})},e.events.trigger=function(a){var b=Array.prototype.slice.call(arguments,1);if(_.has(this._events,a)){var c=this._events[a];_.each(c,function(a){var c=_.bind(a.callback,a.context);c.apply(this,b)})}},e.events.off=function(a){_.has(this._events,a)&&delete this._events[a]},e.isSillyFirefox=function(){var a=e.$el.position().left,b=e.$el.find("td:first").position().left;return b!==a},e.registerEditor=function(a){var b=new a(e);e.editors[b.name]=b},e.registerRowAction=function(a){var b=new a(e);e.rowActions[b.name]=b},e.render=function(){e.renderBaseTable(),e.renderColumns(),e.renderData(),_.each(e.editors,function(a){a.initialize(),a.render(),a.getElement().hide()}),_.each(e.rowActions,function(a){a.initialize(),a.render(),a.getElement().hide()}),e.bindEvents()},e.destroy=function(){e.unbindEvents(),e.$el.remove()},e.addEdit=function(a){e.editPointer===e.edits.length-1?(e.editPointer+=1,e.edits.push(a)):(e.editPointer+=1,e.edits.splice(e.editPointer),e.edits.push(a))},e.redo=function(){return e.editPointer+1>=e.edits.length?[]:(e.editPointer+=1,e.edits[e.editPointer])},e.undo=function(){if(e.editPointer<0)return[];var a=e.edits[e.editPointer];return e.editPointer-=1,a},e.bindEvents=function(){e.unbindEvents(),e.$el.on("click.grid","tr>td",e.clickCell),e.$el.on("dblclick.grid","tr>td",e.dblClickCell),e.$el.on("blur.grid",e.blur),e.$el.on("keydown.grid",e.keydown),e.$el.on("click.grid","tr>th.sensei-grid-sortable",e.sort),a(document).on("click.grid",e.editorBlur)},e.unbindEvents=function(){e.$el.off(".grid"),a(document).off(".grid")},e.sort=function(){var b=a(this).text(),c="asc";e.$el.find("th.sensei-grid-sortable .glyphicon").remove(),a(this).data("order")&&"asc"===a(this).data("order")?(c="desc",a(this).append(a("<span>").addClass("glyphicon glyphicon-chevron-up"))):a(this).append(a("<span>").addClass("glyphicon glyphicon-chevron-down")),a(this).data("order",c),e.events.trigger("column:sort",b,c,a(this)),e.renderData()},e.editorBlur=function(b){e.getActiveCell().length>0&&0===e.$el.has(a(b.target)).length&&(e.exitEditor(),e.deactivateCell())},e.hideEditors=function(){a(".sensei-grid-editor",e.$el).hide()},e.blur=function(){if(e.getActiveCell().length>0&&!e.isEditing){var a=e.getActiveCell();e.exitEditor(),e.isEditing=!1,e.deactivateCell(),g(a.parent("tr"))}},e.parsers={},e.parsers.string=function(a){return a.toString()},e.parsers["int"]=function(a){return parseInt(a)},e.parsers["float"]=function(a){return parseFloat(a)},e.getCellData=function(a){var b=a.text(),c=e.getCellType(a);return _.has(e.parsers,c)&&(b=e.parsers[c](b)),b},e.getCellColumn=function(a){return a.data("column")},e.getCellType=function(a){return a.data("type")},e.getCellStatus=function(a){return!!a.data("saved")},e.getCellDataByIndex=function(a,b){var c=e.getRowByIndex(a),d=e.getCellFromRowByIndex(c,b);return e.getCellData(d)},e.getCellDataByKey=function(a,b){var c=e.getRowByIndex(a),d=e.getCellFromRowByKey(c,b);return e.getCellData(d)},e.getCellFromRowByIndex=function(a,b){var c=a.find("td").eq(b);if(0===c.length)throw new Error("Cell does not exist");return c},e.getCellFromRowByKey=function(b,c){var d=b.find("td").filter(function(){return a(this).data("column")===c});if(0===d.length)throw new Error("Cell does not exist");return d},e.getCellRow=function(a){return a.parent("tr")},e.getRowCellsByIndex=function(a){return e.getRowByIndex(a).find("td")},e.getRowCells=function(a){return a.find("td")},e.getRowByIndex=function(a){var b=e.$el.find("tbody>tr").eq(a);if(0===b.length)throw new Error("Row does not exist");return b},e.getRowDataByIndex=function(a){var b=e.getRowByIndex(a);return e.getRowData(b)},e.getRowData=function(b){var c=e.getRowCells(b),d={};return c.each(function(){d[e.getCellColumn(a(this))]=e.getCellData(a(this))}),d},e.getRows=function(){return e.$el.find("tbody>tr")},e.getGridData=function(){var b=e.getRows();return b.map(function(){return e.getRowData(a(this))}).get()},e.getActiveCell=function(){return e.isEditing&&e.activeEditor&&e.activeEditor.activeCell?e.activeEditor.activeCell:a("td.activeCell",e.$el)},e.setRowSaved=function(a){a.removeClass("sensei-grid-dirty-row").removeClass("sensei-grid-empty-row"),a.find(">td").data("saved",!0)},e.setRowDirty=function(a){a.addClass("sensei-grid-dirty-row").removeClass("sensei-grid-empty-row"),a.find(">td").data("saved",!1)},e.deactivateCell=function(){var a=e.getActiveCell();a.removeClass("activeCell"),a.parent("tr").removeClass("activeRow"),e.events.trigger("cell:deactivate",a)},e.clearActiveCell=function(){var b=e.getActiveCell(),c=e.getCellData(b);a(">div",b).empty(),e.events.trigger("cell:clear",c,b)},e.removeActiveRow=function(){var a=e.getActiveCell();if(!a)return!1;var b=e.getCellRow(a);if(b.hasClass("sensei-grid-empty-row"))return!1;e.moveDown();var c=e.getRowData(b);return b.remove(),e.events.trigger("row:remove",b,c),!0},e.duplicateActiveRow=function(){var b=e.getActiveCell();if(!b)return!1;var c=e.getCellRow(b);if(c.hasClass("sensei-grid-empty-row"))return!1;var d=e.getRowData(c),f=a(e.renderRow(d,!1,!0));return f.insertAfter(c),e.moveDown(),e.events.trigger("row:duplicate",f),!0},e.moveRight=function(){var b=e.getActiveCell();if(b.next().length>0)b.next().setActiveCell();else{var c=b.parent("tr").next();c.length>0&&a("td:first",c).setActiveCell()}},e.moveUp=function(){var b=e.getActiveCell(),c=b.parent("tr").prev();if(c.length>0){var d=b.index(),f=a("td",c).eq(d);f.length>0?f.setActiveCell():a("td:last",c).setActiveCell()}},e.moveLeft=function(){var b=e.getActiveCell();if(b.prev().length>0)b.prev().setActiveCell();else{var c=b.parent("tr").prev();c.length>0&&a("td:last",c).setActiveCell()}},e.moveDown=function(){var b=e.getActiveCell(),c=b.parent("tr").next();if(c.length>0){var d=b.index(),f=a("td",c).eq(d);f.length>0?f.setActiveCell():a("td:first",c).setActiveCell()}},e.move=function(a){var b="move"+a.charAt(0).toUpperCase()+a.substr(1);_.has(e,b)?(e[b](),e.isEditing&&e.saveEditor(),e.isEditing&&e.editCell(),e.getActiveCell().find(">div").isOnScreen()||e.getActiveCell().get(0).scrollIntoView(_.contains(["up","left"],a)?!0:!1)):console.warn("move method not found",b)},e.editCell=function(){e.showEditor()},e.getEditor=function(){return e.activeEditor},e.getEditorInstance=function(){var a=e.getActiveCell(),b=a.data("editor");if(b&&_.has(e.editors,b)){var c=e.getCellColumn(a);return _.has(e.editorProps,c)&&(e.editors[b].props=e.editorProps[c]),e.editors[b]}throw Error("Editor not found: "+b)},e.saveEditor=function(b){if(e.isEditing){var c=e.getActiveCell(),d=e.activeEditor.getValue();if(h(d)!==h(c.text())){var f={previousState:e.getCellData(c),currentState:d,row:e.getRowData(e.getCellRow(c)).id,column:c.index()};e.addEdit(f),c.html(a("<div>").text(d));var g={};g[c.data("column")]=d,e.events.trigger("editor:save",g,c);var i=c.parent("tr");i.hasClass("sensei-grid-empty-row")&&(i.removeClass("sensei-grid-empty-row").addClass("sensei-grid-dirty-row"),e.assureEmptyRow())}}b||e.getEditor().hide()},e.assureEmptyRow=function(){if(e.config.emptyRow&&0===e.$el.find(">table>tbody>tr.sensei-grid-empty-row").length){var a=e.$el.find(">table>tbody"),b=e.renderRow(null,!1);a.append(b)}},e.exitEditor=function(a){var b=e.getActiveCell();if(e.isEditing&&e.activeEditor)if(a)e.getEditor().hide();else{e.saveEditor();var c=b.parent("tr");c.hasClass("sensei-grid-dirty-row")&&e.isEditing&&e.events.trigger("row:save",e.getRowData(c),c,"editor:close")}e.isEditing&&(b.setActiveCell(),e.$el.focus()),e.isEditing=!1},e.moveEditor=function(){e.isEditing&&(e.showEditor(),e.editCell())},e.showEditor=function(){e.activeEditor=e.getEditorInstance();var a=e.activeEditor.getElement(),b=e.getActiveCell();e.activeEditor.activeCell=b,e.isEditing=!0,e.activeEditor.show(),a.css(b.cellPosition()),e.activeEditor.setDimensions(b);var c=b.data("column"),d=b.text();e.activeEditor.setValue(d);var f={};return f[c]=d,e.events.trigger("editor:load",f,b),a},e.keydown=function(b){var c=!0,d=[8,9,13,27,37,38,39,40,90,89,68],f=[8,37,38,39,40,68];if(!(0===e.getActiveCell().length&&!e.isEditing||!_.contains(d,b.which)||e.isEditing&&_.contains(f,b.which))){switch(b.preventDefault(),b.which){case 37:e.move("left");break;case 38:e.move("up");break;case 39:e.move("right");break;case 40:e.move("down");break;case 13:e.isEditing?b.ctrlKey&&b.shiftKey?e.move("up"):b.ctrlKey&&!b.shiftKey?e.move("down"):e.preventEnter||e.exitEditor():e.editCell();break;case 27:e.isEditing?e.exitEditor(!0):e.$el.blur();break;case 9:e.move(b.shiftKey?"left":"right");break;case 8:b.ctrlKey||b.metaKey?e.removeActiveRow():e.clearActiveCell();break;case 90:if(b.ctrlKey||b.metaKey){var g=e.undo();if("row"in g&&"column"in g){var h=e.getRowByIndex(g.row-1),i=e.getCellFromRowByIndex(h,g.column);i.html(a("<div>").text(g.previousState));var j={};j[i.data("column")]=g.previousState,e.events.trigger("editor:save",j,i)}}break;case 89:if(b.ctrlKey||b.metaKey){var k=e.redo();if("row"in k&&"column"in k){var l=e.getRowByIndex(k.row-1),m=e.getCellFromRowByIndex(l,k.column);m.html(a("<div>").text(k.currentState));var n={};n[m.data("column")]=k.currentState,e.events.trigger("editor:save",n,m)}}break;case 68:(b.ctrlKey||b.shiftKey)&&e.duplicateActiveRow()}c&&b.preventDefault()}},e.clickCell=function(b){b.preventDefault(),e.isEditing&&e.exitEditor(),a(this).setActiveCell()},e.dblClickCell=function(b){b.preventDefault(),a(this).setActiveCell(),e.editCell()},e.renderColumns=function(){var b=a("thead",e.$el),c=document.createElement("tr");_.each(e.columns,function(b){var d=document.createElement("th"),f=document.createElement("div");e.config.sortable&&(d.className="sensei-grid-sortable"),a(f).text(b.name),d.appendChild(f),a(d).data("type",b.type||"string"),a(d).data("editor",b.editor||"BasicEditor"),b.editorProps&&(e.editorProps[b.name]=b.editorProps),c.appendChild(d)}),b.append(c)},e.renderData=function(){var b=a("tbody",e.$el);if(b.html(null),_.each(e.data,function(a){var c=e.renderRow(a,!0);b.append(c)}),e.config.emptyRow){var c=e.renderRow(null,!1);b.append(c)}},e.renderRow=function(b,c,d){var f=document.createElement("tr");return c||(f.className="sensei-grid-empty-row"),d&&(f.className="sensei-grid-dirty-row"),_.each(e.columns,function(d){var e=document.createElement("td"),g=document.createElement("div");_.has(b,d.name)&&a(g).text(b[d.name]),a(e).data("column",d.name),a(e).data("type",d.type||"string"),a(e).data("editor",d.editor||"BasicEditor"),a(e).data("saved",c),e.appendChild(g),f.appendChild(e)}),f},e.renderBaseTable=function(){var a=document.createElement("table"),b=document.createElement("thead"),c=document.createElement("tbody");a.appendChild(b),a.appendChild(c),a.className=e.config.tableClass,e.$el.html(a),e.$el.attr("tabindex",-1)},e.init=function(b,c,d){return e.config=a.extend({},f,d),e.data=b,e.columns=c,e.$el=a(this),e.editors={},e.rowActions={},e.edits=[],e.editPointer=-1,e},e.init(b,c,d)}}(jQuery),function(a){var b=this,c=function(a){this.grid=a};c.extend=function(a){var b,c=this;b=function(){return c.apply(this,arguments)};var d=function(){this.constructor=b};return d.prototype=c.prototype,b.prototype=new d,a&&_.extend(b.prototype,a),b.__super__=c.prototype,b},c.prototype.getElement=function(){return a(this.editor)},c.prototype.initialize=function(){},c.prototype.render=function(){},c.prototype.show=function(){this.getElement().show()},c.prototype.hide=function(){this.getElement().hide(),this.grid.activeEditor.activeCell=null,this.grid.activeEditor=null},c.prototype.setDimensions=function(a){this.getElement().css({width:a.outerWidth()+1,height:a.outerHeight()+1})},c.prototype.getValue=function(){throw Error("Editor.getValue not implemented")},c.prototype.setValue=function(){throw Error("Editor.setValue not implemented")},b.Editor=c,b.BasicEditor=c.extend({types:[],name:"BasicEditor",render:function(){if(!this.editor){this.editor=document.createElement("div"),this.editor.className="sensei-grid-editor sensei-grid-basic-editor";var a=document.createElement("input");a.setAttribute("type","text"),this.editor.appendChild(a),this.grid.$el.append(this.editor)}},getValue:function(){return a("input",this.editor).val()},setValue:function(b){a("input",this.editor).val(b).focus()}}),b.TextareaEditor=c.extend({types:[],name:"TextareaEditor",render:function(){if(!this.editor){this.editor=document.createElement("div"),this.editor.className="sensei-grid-editor sensei-grid-textarea-editor";var a=document.createElement("textarea");this.editor.appendChild(a),this.grid.$el.append(this.editor)}},setDimensions:function(a){this.getElement().find("textarea").css({width:a.outerWidth()+50,height:a.outerHeight()+50})},getValue:function(){return a("textarea",this.editor).val()},setValue:function(b){a("textarea",this.editor).val(b).focus()}}),b.BooleanEditor=c.extend({types:[],name:"BooleanEditor",render:function(){if(!this.editor){this.editor=document.createElement("div"),this.editor.className="sensei-grid-editor sensei-grid-boolean-editor";var b=a("<div>",{"class":"sensei-grid-checkbox-wrapper"});b.append(a("<input>",{type:"checkbox"})),a(this.editor).append(b),this.grid.$el.append(this.editor)}},setDimensions:function(a){var b={width:a.outerWidth()-3,height:a.outerHeight()-3,background:"white"};this.getElement().find(".sensei-grid-checkbox-wrapper").css(b)},getValue:function(){return a("input",this.editor).is(":checked")?"true":"false"},setValue:function(b){"true"===b.toLowerCase()?a("input",this.editor).prop("checked",!0):a("input",this.editor).prop("checked",!1),a("input",this.editor).focus()}}),b.SelectEditor=c.extend({types:[],name:"SelectEditor",render:function(){if(console.log("CustomEditor.render"),!this.editor){this.editor=document.createElement("div"),this.editor.className="sensei-grid-editor sensei-grid-custom-editor";var a=document.createElement("select");this.editor.appendChild(a),this.grid.$el.append(this.editor)}},renderValues:function(){if(_.has(this.props,"values")){var a=this.getElement().find("select");a.html(null),_.each(this.props.values,function(b){var c=document.createElement("option");c.value=b,c.innerHTML=b,a.append(c)})}},show:function(){this.renderValues(),this.getElement().show()},getValue:function(){return a("select",this.editor).val()},setValue:function(b){console.log("Set selectbox value",b,a("select>option")),a("select>option",this.editor).filter(function(){return a(this).val()===b}).attr("selected","selected"),a("select").focus()}}),b.DateEditor=c.extend({types:[],name:"DateEditor",render:function(){if(!this.editor){this.editor=document.createElement("div"),this.editor.className="sensei-grid-editor sensei-grid-date-editor";var b=a("<div>",{"class":"sensei-grid-date-wrapper"});b.append(a("<input>",{type:"text","class":"datepicker"})),a(this.editor).append(b),this.grid.$el.append(this.editor);var c=this.grid;a(".datepicker").pickadate({format:"ddd mmm dd yyyy",editable:!0,today:!1,clear:!1,close:!1,onClose:function(){c.preventEnter=!1},onOpen:function(){c.preventEnter=!0}})}},getValue:function(){return a("input",this.editor).val()},setValue:function(b){a("input",this.editor).val(b).focus()}}),b.DisabledEditor=c.extend({types:[],name:"DisabledEditor",render:function(){if(!this.editor){this.editor=document.createElement("div"),this.editor.className="sensei-grid-editor sensei-grid-disabled-editor";var b=a("<input>",{type:"text",readOnly:!0});a(this.editor).append(b),this.grid.$el.append(this.editor)}},getValue:function(){return a("input",this.editor).val()},setValue:function(b){a("input",this.editor).val(b).focus()}}),b.RichEditor=c.extend({types:[],name:"RichEditor",render:function(){if(!this.editor){this.editor=a("<div>",{"class":"sensei-grid-editor sensei-grid-rich-editor"});var b=a("<div>",{"class":"summertime-wrapper"});this.editor.append(b),this.grid.$el.append(this.editor)}},setDimensions:function(a){this.getElement().css({width:a.outerWidth()+50})},getValue:function(){return a(".summertime-wrapper",this.editor).code()},setValue:function(b){a(".summertime-wrapper",this.editor).destroy(),a(".summertime-wrapper",this.editor).html(b);var c=this.grid;a(".summertime-wrapper",this.editor).summernote({focus:!0,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["fontsize",["fontsize"]]],onfocus:function(){c.preventEnter=!0},onblur:function(){c.preventEnter=!1},onkeydown:function(a){9===a.keyCode&&a.stopImmediatePropagation()}}),a(".summertime-wrapper",this.editor).code(b)}})}(jQuery);